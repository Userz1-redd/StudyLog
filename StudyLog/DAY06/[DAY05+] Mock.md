# 등장배경

멘토님의 말씀을 듣고 그동안 제대로 이해하지 못했던 Mock에 대해 이해하고, 이것을 왜 사용해야 하는지에 대해 먼저 정리하였습니다.

안드로이드 뿐만 아니라 스프링 등 어떤 하나의 애플리케이션을 만들 때, 안정성을 위해서는 항상 테스트가 동반되어야 합니다.

그 중 하나의 메소드를 테스트하는 경우, 단위 테스트를 하기 위해 메소드와연관된 모든 로직을 다 호출해야 하는 상황이 생기게 됩니다.

예를들어, 사용자가 검색버튼을 누르면 View가 Presenter에게 요청을 전달하고 MVP의 Presenter가 Repository에 접근하여 Retrofit을 통해 특정 데이터를 받아온다고 할 때

Presenter단에서 Repository에 접근하고 데이터를 받아오는 그 메소드 자체를 테스트 하기 위해서 의존하고 있는 모든 메소드를 호출해야할까?라는 생각에서 고안된 것입니다.

이런경우, 의존성으로인해 단위 테스트는 매우 어려워지고 이것을 돕기 위한 Mock이라는 것이 등장하였습니다.

# Mock 이란

테스트시 실제 객체를 생성하여 사용하기엔 시간이나 비용등의 Cost가 높거나 의존관계가 많이 얽힌경우, 가짜 객체를 만들어 사용하는 방법입니다.

Mock객체는 아래와 같은 상황에서 사용하게 됩니다.

- 테스트 작성을 위한 환경 구축이 어려운 경우

- 테스트가 특정 경우나 순간에 의존적인 경우

- 테스트 시간이 오래걸리는 경우

# Mock의 기본적인 분류 개념

1. 테스트 더블

- 테스트를 진행하기 어려운 경우 이를 대신해 테스트를 진행할 수 있도록 만들어 주는 객체를 말합니다.

- Mock객체와 유사하지만 테스트 더블이 좀더 넓은 의미로 사용됩니다.

2. Dummy Object

- 단순히 인스턴스화 될수 있는 수준으로만 객체를 구현합니다.

- 인스턴스화 된 객체가 필요할 뿐, 해당 객체의 기능까지는 필요하지 않은 경우에 사용합니다.

3. 테스트 스텁

- 더미 객체보다 좀 더 구현된 객체로 더미객체가 마치 실제로 동작하는 것처럼 보이게 만들어 놓은 객체입니다.

- 객체의 특정 상태를 가정해서 만들어 특정 값을 리턴해주거나 특정 메세지를 출력해주는 작업을 합니다.

- 특정 상태를 가정해서 하드코딩된 형태이며 로직에 따른 값의 변경은 테스트가 불가능합니다.

- 어떤 행위가 호출되었을 때 특정 값으로 리턴시켜주는 형태입니다.

4. Fake Object

- 여러 상태를 대표할 수 있도록 구현된 객체로 실제 로직이 구현된 것처럼 보이게 합니다.

- 실제 DB에 접속해서 동일한 모양이 보이도록 객체 내부에 구현할 수 있습니다.
  
  - 테스트 작성을 위해 다른 객체와의 의존성 제거를 위해 사용됩니다.
  
  - 페이크 객체를 생성할 때 복잡도로 인해서 생성에 어려움이 있는경우 적절한 수준까지만 구현하거나 Mock프레임워크를 사용합니다.
  
  - 페이크 객체를 생성하기 위한 cost가 많이 드는 경우 굳이 페이크객체를 사용하는 의미가 없으므로 실제 객체를 가져와 테스트합니다.
  
5. TestSpy

- 테스트에 사용되는 객체, 메소드의 사용 여부 및 정상 호출 여부를 기록하고 호출시 알려줍니다.

- 테스트 더블로 구현된 객체에 자기 자신이 호출 되었을 때, 확인이 필요한 부분을 기록하도록 구현합니다.

- 특정 메소드의 호출 횟수만이 필요한경우, 전역 변수로 카운트를 설정하고, 특정 테스트 메소드에 카운트를 올리는 부분을 추가한 후 이 카운트를 가져오는 메소드를 추가합니다.

- 특정 메소드가 호출 되었을 때 또 다른 메소드가 실행이 되어야 한다와 같은 행위 기반 테스트가 필요한 경우 사용됩니다.

6. Mock Object

- 행위를 검증하기 위해 사용되는 객체이며 수동으로 만들 수 있고 프레임워크를 통해 만드는 것도 가능합니다.

- 행위 기반 테스트는 복잡도나 정확성 등 작성하기 어려운부분이 많기 때문에 상태 기반 테스트가 가능한 경우에는 생성하지 않습니다.

- Mock Object는 테스트 더블의 하위객체로 좁은의미와 테스트더블을 포함한 넓은 의미 2가지로 사용될 수 있습니다.

## Mock 객체는 행위 검증에 사용되며, Stub은 상태 검증에 사용한다는 것이 특징입니다.

## Mock 사용시 유의사항

-	Mock이 정말로 필요한지 확인 후 사용합니다.
 
-	Mock을 사용하는 경우 테스트케이스 유지에 복잡성이 더해지기 때문에 Mock이 없는 의존성 적은 구조로 프로그래밍 해야합니다.

-	Mock객체는 단순한 Mock일 뿐입니다.

-	실제 객체로 테스트하였을 때, 잘 작동하지 않을 수도 있습니다. Mock객체는 단순히 흉내를 내는 객체이기 때문에 유의해서 사용해야 합니다.
